---
import { getSecret } from 'astro:env/server'

import { apiRequest } from '~/services/api.service'

const API_URL = getSecret('API_URL')

try {
  const { success, message } = await apiRequest(`${API_URL}/auth/logout`, {
    method: 'POST'
  })

  Astro.cookies.delete('auth_token')

  success ? console.log('Logged out successfully') : console.error('Error logging out', message)
} catch (error) {
  console.error('Error during logout:', error)
}

return Astro.redirect('/')
---
